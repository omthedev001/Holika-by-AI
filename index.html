<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holika Gatherer: Retro Edition</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #1a1a2e;
            font-family: 'Press Start 2P', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ensure minimum viewport height */
            width: 100%;
        }
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        #gameCanvas {
            width: 100%; /* Responsive width */
            max-width: 1200px; /* Maximum width to prevent excessive scaling */
            height: 90vh; /* 90% of viewport height to fit within screen */
            min-height: 600px; /* Minimum height to ensure visibility */
            position: relative;
            overflow: hidden;
            image-rendering: pixelated;
            margin: 0 auto; /* Center the canvas */
        }
        #gamePlayArea {
            position: relative;
            width: 100%;
            height: 100%;
        }
        #nightSky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 40%; /* 40% of canvas height */
            background: #000033;
            z-index: 0;
        }
        #gardenArea {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%; /* 60% of canvas height */
            background: linear-gradient(to bottom, #2e7d32, #4caf50);
            z-index: 1;
        }
        #treesLeft, #treesRight {
            position: absolute;
            top: 0;
            width: 10.66vw; /* Responsive width (10.66vw ‚âà 128px at 1200px) */
            height: 14.22vh; /* Responsive height (14.22vh ‚âà 128px at 900px) */
            font-size: 8vw; /* Responsive font size (8vw ‚âà 96px at 1200px) */
            z-index: 2;
        }
        #treesLeft { left: 0; }
        #treesRight { right: 0; }
        .material {
            position: absolute;
            width: 5.33vw; /* Responsive width (5.33vw ‚âà 64px at 1200px) */
            height: 7.11vh; /* Responsive height (7.11vh ‚âà 64px at 900px) */
            font-size: 4vw; /* Responsive font size (4vw ‚âà 48px at 1200px) */
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.5s;
            z-index: 3;
            image-rendering: pixelated;
        }
        .good { color: #ffd700; }
        .bad { color: #ff4040; }
        .material:hover { transform: scale(1.2); }
        .animation {
            position: absolute;
            font-size: 2.67vw; /* Responsive (2.67vw ‚âà 32px at 1200px) */
            pointer-events: none;
            transition: all 0.8s;
            text-shadow: 2px 2px 0 #000;
            z-index: 4;
        }
        #scoreContainer {
            position: absolute;
            top: 2.22vh; /* Responsive (2.22vh ‚âà 20px at 900px) */
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            text-shadow: 3px 3px 0 #000;
            z-index: 5;
            text-align: center;
        }
        #scoreDisplay {
            font-size: 4vw; /* Responsive (4vw ‚âà 48px at 1200px) */
        }
        #targetDisplay {
            font-size: 2.67vw; /* Responsive (2.67vw ‚âà 32px at 1200px) */
            margin-top: 1.11vh; /* Responsive (1.11vh ‚âà 10px at 900px) */
            color: #ffd700;
        }
        @keyframes scoreGlow {
            0% { text-shadow: 3px 3px 0 #000; }
            50% { text-shadow: 0 0 15px #ffd700, 3px 3px 0 #000; }
            100% { text-shadow: 3px 3px 0 #000; }
        }
        .score-update {
            animation: scoreGlow 0.3s;
        }
        #hud {
            position: absolute;
            top: 2.22vh; /* Responsive */
            left: 2.22vh; /* Responsive */
            color: #fff;
            text-shadow: 3px 3px 0 #000;
            z-index: 5;
        }
        #progressBar {
            width: 25vw; /* Responsive (25vw ‚âà 300px at 1200px) */
            height: 2.22vh; /* Responsive (2.22vh ‚âà 20px at 900px) */
            border: 3px solid #fff;
            background: #333;
            margin-top: 1.11vh; /* Responsive */
        }
        #progressFill {
            height: 100%;
            background: #ff6f61;
            width: 0%;
            transition: width 0.3s;
        }
        #timer {
            font-size: 2.67vw; /* Responsive (2.67vw ‚âà 32px at 1200px) */
            position: absolute;
            top: 2.22vh; /* Responsive */
            right: 2.22vh; /* Responsive */
            color: #fff;
            text-shadow: 3px 3px 0 #000;
            z-index: 5;
        }
        #introScreen, #endScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 2.67vw; /* Responsive */
            z-index: 6;
        }
        #introMessage, #endMessage { margin-bottom: 3.33vh; /* Responsive */ }
        #startBtn, #replayBtn {
            padding: 1.67vh 3.33vw; /* Responsive */
            font-family: inherit;
            font-size: 2.67vw; /* Responsive */
            cursor: pointer;
            background: #ff6f61;
            border: 3px solid #fff;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
        }
        #startBtn:hover, #replayBtn:hover { background: #e63946; }
        #videoPlaceholder {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: #fff;
            justify-content: center;
            align-items: center;
            font-size: 3.33vw; /* Responsive */
            z-index: 7;
        }
        .fade-out { animation: fadeOut 1s forwards; }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 1200px) {
            #gameCanvas { max-width: 100%; }
            .material { font-size: 3vw; }
            #scoreDisplay { font-size: 3.5vw; }
            #targetDisplay { font-size: 2.5vw; }
            #timer { font-size: 2.5vw; }
            #introScreen, #endScreen { font-size: 2.5vw; }
            #startBtn, #replayBtn { font-size: 2.5vw; }
        }
        @media (max-width: 800px) {
            .material { font-size: 2.5vw; }
            #scoreDisplay { font-size: 3vw; }
            #targetDisplay { font-size: 2vw; }
            #timer { font-size: 2vw; }
            #introScreen, #endScreen { font-size: 2vw; }
            #startBtn, #replayBtn { font-size: 2vw; }
        }
    </style>
</head>
<body>
    <div id="gameCanvas">
        <div id="gamePlayArea">
            <div id="nightSky"></div>
            <div id="gardenArea">
                <div id="treesLeft">üå≥</div>
                <div id="treesRight">üå≥</div>
            </div>
            <div id="scoreContainer">
                <div id="scoreDisplay">Score: 0</div>
                <div id="targetDisplay">Target: 50</div>
            </div>
            <div id="hud">
                <div id="progressBar"><div id="progressFill"></div></div>
            </div>
            <div id="timer">Time: 1:30</div>
        </div>
        <div id="introScreen">
            <div id="introMessage">
                Welcome to Holika Gatherer!<br>
                Gather materials for the bonfire<br>
                before the night ends!<br>
                (Press Start)
            </div>
            <button id="startBtn">Start</button>
        </div>
        <div id="endScreen">
            <div id="endMessage"></div>
            <button id="replayBtn">Play Again</button>
        </div>
        <div id="videoPlaceholder">Video Playing (Replace with <video> tag)</div>
    </div>

    <script>
        const gameCanvas = document.getElementById('gameCanvas');
        const gamePlayArea = document.getElementById('gamePlayArea');
        const gardenArea = document.getElementById('gardenArea');
        const nightSky = document.getElementById('nightSky');
        const scoreContainer = document.getElementById('scoreContainer');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const targetDisplay = document.getElementById('targetDisplay');
        const progressFill = document.getElementById('progressFill');
        const timerText = document.getElementById('timer');
        const introScreen = document.getElementById('introScreen');
        const endScreen = document.getElementById('endScreen');
        const endMessage = document.getElementById('endMessage');
        const replayBtn = document.getElementById('replayBtn');
        const startBtn = document.getElementById('startBtn');
        const videoPlaceholder = document.getElementById('videoPlaceholder');

        let score = 0;
        const goal = 50;
        let timeLeft = 90;
        let gameActive = false;
        let materials = [];

        const goodMaterials = [
            { sprite: 'ü™µ', type: 'wood', value: 5 },
            { sprite: 'üí©', type: 'cowdung', value: 5 },
            { sprite: 'üçÉ', type: 'leaves', value: 5 }
        ];
        const badMaterials = [
            { sprite: 'ü•§', type: 'plastic', value: -1 },
            { sprite: 'üìú', type: 'wrapper', value: -1 }
        ];

        function createNightSky() {
            const starCount = 50;
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.style.position = 'absolute';
                star.style.width = '5px';
                star.style.height = '5px';
                star.style.background = '#fff';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                nightSky.appendChild(star);
            }
            const moon = document.createElement('div');
            moon.style.position = 'absolute';
            moon.style.width = '50px';
            moon.style.height = '50px';
            moon.style.background = '#ffd700';
            moon.style.borderRadius = '50%';
            moon.style.left = '15%';
            moon.style.top = '25%';
            nightSky.appendChild(moon);
        }
        createNightSky();

        introScreen.style.display = 'flex';

        function spawnMaterial() {
            if (!gameActive) return;
            const isGood = Math.random() < 0.6;
            const materialList = isGood ? goodMaterials : badMaterials;
            const material = materialList[Math.floor(Math.random() * materialList.length)];

            const div = document.createElement('div');
            div.className = `material ${isGood ? 'good' : 'bad'}`;
            div.innerHTML = material.sprite;
            
            // Temporarily hide the element while positioning
            div.style.visibility = 'hidden';
            gardenArea.appendChild(div);

            // Get dimensions after element is in DOM
            const materialWidth = div.offsetWidth;
            const materialHeight = div.offsetHeight;
            const gardenWidth = gardenArea.offsetWidth;
            const gardenHeight = gardenArea.offsetHeight;

            // Calculate valid position range
            const maxLeft = gardenWidth - materialWidth;
            const maxTop = gardenHeight - materialHeight;
            
            // Set random position within bounds
            div.style.left = Math.random() * maxLeft + 'px';
            div.style.top = Math.random() * maxTop + 'px';
            
            // Make visible after positioning
            div.style.visibility = 'visible';

            div.onclick = () => handleClick(div, isGood, material.value);
            materials.push(div);

            setTimeout(() => {
                if (div.parentNode) div.style.opacity = '0';
                setTimeout(() => div.remove(), 500);
            }, 5000);
        }


        function handleClick(div, isGood, value) {
            if (!gameActive) return;
            score += value;
            scoreDisplay.textContent = `Score: ${score}`;
            scoreDisplay.classList.add('score-update');
            setTimeout(() => scoreDisplay.classList.remove('score-update'), 300);
            updateProgress();

            const anim = document.createElement('div');
            anim.className = 'animation';
            anim.textContent = value > 0 ? `+${value}` : `${value}`;
            anim.style.color = value > 0 ? '#ffd700' : '#ff4040';
            anim.style.left = div.style.left;
            anim.style.top = div.style.top;
            gardenArea.appendChild(anim);
            setTimeout(() => {
                anim.style.top = (parseFloat(anim.style.top) - 30) + 'px';
                anim.style.opacity = '0';
            }, 10);
            setTimeout(() => anim.remove(), 800);

            div.style.opacity = '0';
            setTimeout(() => div.remove(), 500);
            materials = materials.filter(m => m !== div);
            checkGameEnd();
        }

        function updateProgress() {
            const progress = Math.min(score / goal, 1) * 100;
            progressFill.style.width = `${progress}%`;
        }

        function updateTimer() {
            if (!gameActive) return;
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerText.textContent = `Time: ${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
            if (timeLeft <= 10) timerText.style.color = '#ff4040';
            if (timeLeft <= 0) endGame(false);
        }

        function checkGameEnd() {
            if (score >= goal) endGame(true);
            else if (score < -5) endGame(false);
        }

        function endGame(won) {
            gameActive = false;
            gamePlayArea.classList.add('fade-out');
            setTimeout(() => {
                endScreen.style.display = 'flex';
                if (won) {
                    endMessage.innerHTML = 'Holika Burns Bright!<br>Happy Holika Dahan! üî•';
                    endMessage.style.color = '#ff6f61';
                    const bonfire = document.createElement('div');
                    bonfire.style.position = 'absolute';
                    bonfire.style.left = '550px';
                    bonfire.style.top = '350px';
                    bonfire.style.fontSize = '96px';
                    bonfire.innerHTML = 'üî•';
                    gardenArea.appendChild(bonfire);
                    const family = document.createElement('div');
                    family.style.position = 'absolute';
                    family.style.left = '500px';
                    family.style.top = '300px';
                    family.style.fontSize = '48px';
                    family.innerHTML = 'üë®‚Äçüë©‚Äçüëß';
                    gardenArea.appendChild(family);
                } else {
                    endMessage.textContent = 'Game Over: Celebration Failed!';
                    endMessage.style.color = '#a9a9a9';
                }
                setTimeout(() => {
                    endScreen.style.display = 'none';
                    videoPlaceholder.style.display = 'flex';
                }, 2000);
            }, 1000);
        }

        replayBtn.onclick = () => location.reload();
        startBtn.onclick = () => {
            introScreen.style.display = 'none';
            gameActive = true;
            setInterval(spawnMaterial, 1200);
            setInterval(updateTimer, 1000);
            spawnMaterial();
        };
    </script>
</body>
</html>